[{"authors":["admin"],"categories":null,"content":"I’m a scientist and engineer with a proven track record of hardware and software development whose research has been featured on the cover of Science magazine. In graduate school at Berkeley I trained as a physical chemist and spectroscopist before diving into imaging and biology as a post-doc in Nobel Laureate Eric Betzig’s group. While I enjoy digging into the nuts and bolts of instrumentation, theory and code, I always see my work in the context of the big picture and strive to do the most useful thing most efficiently. I’m goal focused, data driven and led by curiosity.\n","date":-62135596800,"expirydate":-62135596800,"kind":"taxonomy","lang":"en","lastmod":1585949198,"objectID":"2525497d367e79493fd32b198b28f040","permalink":"https://david-hoffman.github.io/authors/admin/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/admin/","section":"authors","summary":"I’m a scientist and engineer with a proven track record of hardware and software development whose research has been featured on the cover of Science magazine. In graduate school at Berkeley I trained as a physical chemist and spectroscopist before diving into imaging and biology as a post-doc in Nobel Laureate Eric Betzig’s group. While I enjoy digging into the nuts and bolts of instrumentation, theory and code, I always see my work in the context of the big picture and strive to do the most useful thing most efficiently.","tags":null,"title":"David P. Hoffman","type":"authors"},{"authors":["David P. Hoffman"],"categories":[],"content":"People have been arguing over the \u0026ldquo;real\u0026rdquo; resolution of single molecule localization microscopy (SMLM) since it\u0026rsquo;s inception1 (see the many references in Legant et al.2). New comers are often wowed by the insanely small localization precisions achievable with modern SMLM microscopes and dyes which can routinely drop below 10 nm (a factor of nearly 20 fold below the diffraction limit 🤯). However, it is clear to \u0026ldquo;those skilled in the art\u0026rdquo; that this merely represents the lower bound for the actual resolution of one\u0026rsquo;s image.\nEarly on in the debate, many made frequent appeals to the concept of Nyquist sampling which simply states that you must sample at twice the highest frequency you\u0026rsquo;re hoping to measure. Because images are made up of spatial frequencies the argument is that you need a localization density of at least twice the highest frequency you\u0026rsquo;re trying to measure. For instance, let\u0026rsquo;s say you wanted to measure ER tubules of approximately 50 nm in diameter then you\u0026rsquo;d need at least one localization every 25 nm or 40 localizations every micron \u0026mdash; in a single dimension! If you\u0026rsquo;d like to measure such a structure in 3D then you\u0026rsquo;d need 64,000 molecules per cubic micron! That means you\u0026rsquo;ll need millions or even billions2 of localizations to achieve the resolution you want.\nUnfortunately, the argument laid out above is really a best case scenario and even if you achieved such a high localization rate your signal to noise ratio (SNR) would be 1. To understand why, consider the simple model shown in Fig. 1 below. Here our sample is a one dimensional square wave of period $L$ (wavelength) and height $S$ (signal) offset by an amount $B$ (background). The background is representative of non-specific labeling or junk during imaging.\n\r\rA square wave of period (wavelength) $L$ shown as the thick orange line. The dashed orange line is the background component of intensity $B$ and the green solid line is the signal component of intensity $S$\r\r\rA simple argument would lead you to believe that you want a single molecule localized per period meaning that our desired labeling density is $\\rho = 1 / L$. But this doesn\u0026rsquo;t take into account any noise sources. It\u0026rsquo;s reasonable to assume that protein production, labeling, and imaging (i.e. detection, localization, etc.) all lead to roughly Poisson statistics for localization density. A Poisson distribution has a well defined variance, namely $\\sigma^2 = \\mu$ where $\\mu$ is the mean value, thus the standard deviation is $\\sigma = \\sqrt{\\mu}$. In the case of one localization per period that means you have an SNR of 1 😱.3 If you wanted to have an SNR of 2 you\u0026rsquo;d need 4 localizations, on average, per period. Referring back to our example of ER tubules above this translates to 4 million localizations per cubic micron.4\nIncluding background noise isn\u0026rsquo;t much harder. Assuming the background is also Poisson distributed we can use the Skellam distribution setting $\\mu_1 = S + B$ and $\\mu_2 = B$ which gives an SNR of\n$$ SNR = \\frac{\\mu_1 - \\mu_2}{\\sqrt{\\mu_1 + \\mu_2}} = \\frac{S}{\\sqrt{S + 2B}} $$\nWe can rearrange the above equation, setting $S$ equal to the number of localized molecules per period $N$, to read\n$$ N = \\frac{SNR^2}{2}\\left(1 + \\sqrt{1 + \\frac{8 B}{SNR^2}}\\right) $$\nFor example, if you want and SNR of 3 and your background is 2 molecules, on average, then you\u0026rsquo;d need an average of 12 molecules per period. Again, going back to the ER example that means you\u0026rsquo;d need 111 million localizations per cubic micron.5\nWe can compare this analytical formula to the simulations of Legant et al.2 (see supplemental figures 1 and 3 therein). In that publication a sinusoidal pattern was used but we can normalize the two by averaging the sinusoid\u0026rsquo;s intensity over half periods and using the resulting peak-to-peak intensity as our $S$. For a sinusoid of amplitude $A$ (i.e. $y(x) = A \\sin x$) The integrated amplitude is $2 A /\\pi$. Therefore our normalization factor is $\\pi / 4$.\nFor SI figure 1 we have the following analytical SNRs:\n 0.89 1.25 1.99 2.8  For SI figure 3 we have the following analytical SNRs:\n 1.31 1.05 1.86 1.49  Conclusion Getting really good real resolution in SMLM (i.e. anything below ~50 nm average in $x$, $y$, and $z$) is really hard and requires minimal background and really really good labeling density.6 One saving grace is that this argument assumes you have absolutely no prior knowledge about the structure you\u0026rsquo;re imaging. Take for example Fig 2. below. It doesn\u0026rsquo;t take a whole lot of points before it becomes obvious we\u0026rsquo;re imaging a circle. It takes many more points to get an accurate measure of the width of the circle. But once you\u0026rsquo;re fairly confident that it\u0026rsquo;s a circle you can perform a radial average to determine the width; this type of methodology has been used to great effect before.7 In short, the resolution of your image is not equivalent to your localization precision and resolution, in the traditional sense, may not even be relevant to what you\u0026rsquo;re trying to measure.\n\r\rRandomly sampling points on a circle.\r\r\r  E. Betzig, G. H. Patterson, R. Sougrat, O. W. Lindwasser, S. Olenych, J. S. Bonifacino, M. W. Davidson, J. Lippincott-Schwartz, H. F. Hess, Imaging Intracellular Fluorescent Proteins at Nanometer Resolution. Science. 313, 1642–1645 (2006). \u0026#x21a9;\u0026#xfe0e;\n W. R. Legant, L. Shao, J. B. Grimm, T. A. Brown, D. E. Milkie, B. B. Avants, L. D. Lavis, E. Betzig, High-density three-dimensional localization microscopy across large volumes. Nat Meth. 13, 359–365 (2016) \u0026#x21a9;\u0026#xfe0e;\n Noting that $SNR = \\mu/\\sigma$. PS: I personally would never try to make a scientific argument based on data with an SNR of 1. \u0026#x21a9;\u0026#xfe0e;\n Remember this would be 4M / µm$^3$ only for the actual ER tubule. Considering that the mean diameter of a tubule is 50 nm this equates to roughly 8k molecules per micron of tubule. \u0026#x21a9;\u0026#xfe0e;\n This equates to roughly 220k molecules per micron of tubule. Also, 1 cubic micron is roughly 500 linear microns of ER tubule 😅. \u0026#x21a9;\u0026#xfe0e;\n One of the reasons regular EM is so damn good is due to the fact that the labeling density (e.g. osmium staining) is so high. Even if you could build an optical microscope with the resolution of an electron microscope you\u0026rsquo;d never get to take advantage of it. \u0026#x21a9;\u0026#xfe0e;\n A. Szymborska, A. de Marco, N. Daigle, V. C. Cordes, J. A. G. Briggs, J. Ellenberg, Nuclear Pore Scaffold Structure Analyzed by Super-Resolution Microscopy and Particle Averaging. Science. 341, 655–658 (2013). \u0026#x21a9;\u0026#xfe0e;\n   ","date":1587092352,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1587159210,"objectID":"7ba1ecad290da7846f6167dcdb387fac","permalink":"https://david-hoffman.github.io/post/nyquist-sampling-smlm/","publishdate":"2020-04-16T19:59:12-07:00","relpermalink":"/post/nyquist-sampling-smlm/","section":"post","summary":"Getting really good **real** resolution in SMLM is really hard.","tags":["microscopy","smlm","noise"],"title":"Nyquist Sampling SMLM","type":"post"},{"authors":["David P. Hoffman"],"categories":["a supplemental journey"],"content":"A question of index Something I learned the hard way during my post-doc is the effect index mismatching can have on images taken with high NA air objectives (in my case a Nikon CFI L Plan EPI CRB 100X 0.85 NA lens). Many1 previous2 authors3 have commented on and analyzed degradation of image quality when the index for which an objective is designed does not match the one in which it is used. Even so, many users of optical microscopes remain unaware of this issue. The problems induced by index mismatch can be summarized as follows (where $n_{obj}$ is the design index and $n_{sample}$ is the mounting index):\n NA is reduced to the index of the specimen, i.e. $NA = n_{sample}$, when $n_{obj} \u0026gt; n_{sample}$ Compression of the image when $n_{obj} \u0026lt; n_{sample}$ and a concomitant reduction in expected axial resolution Increasing spherical aberration as the objective\u0026rsquo;s focus is moved deeper into the sample when $n_{obj} \\neq n_{sample}$  To explain the first problem imagine we are imaging a point source radiating spherical waves of light embedded in a medium of index $n_{sample}$ near the interface with a medium of index $n_{obj}$ (c.f. Figure 1). After a certain axial distance the spherical wave encounters the interface and refracts. Appealing to geometrical optical arguments we say that only the bottom hemisphere of light can be captured. The maximum angle of rays that can be captured are rays that propagate along the interface (i.e. at an angle of 90° relative to the interface normal) and these are refracted at an angle $\\theta_c = \\arcsin(n_{sample}/n_{obj})$. According to Snell\u0026rsquo;s law and the definition for NA this means that the maximum possible NA for this configuration is $NA = n_{obj} \\sin(\\theta_c) = n_{sample} \\sin(\\pi/2) = n_{sample}$\n\r\rA point source emitting from a lower index material to a higher index material\r\r\rThe second problem, when $n_{obj} \u0026lt; n_{sample}$, is trickier and I covered it in some detail in the supplemental material of our cryo paper. Looking at the OTF support in the $k_xk_z$ plane, as shown in Figure 2, we can see that the OTF gets \u0026ldquo;squished\u0026rdquo; in the $k_z$ direction. A key insight is that while the lateral resolution is independent of index due to Snell\u0026rsquo;s law, $NA = n_{obj}\\sin(\\theta_{obj}) = n_{sample}\\sin(\\theta_{sample})$, the axial resolution is not.4 Axial resolution (sometimes termed depth of field or depth of focus) for high NA systems has been derived before5 and can be modified for differing indices of refraction to be\n$$ \\Delta z = \\frac{\\lambda}{n_{sample} - \\sqrt{n_{sample}^2 - NA^2}} $$\nand herein lies the observed squishing effect6: as $n_{sample}$ increases relative to $NA$ the denominator decreases and $\\Delta z$ increases.\n\r\rOTF support for fixed NA and variable index of refraction ($n$), specifically comparing air ($n=1$) to vitreous ice ($n=1.3$)\r\r\rInvestigating the third problem will require real math based on the work of Török1, Török2, and Egner.3\nFocal plane displacement in mismatched media, a Vectorial Calculation I\u0026rsquo;ll be following the notation of Egner3. Equation 9 gives the vectorial point spread function in terms of three diffraction integrals. Note that for on axis light ($x=0$ and $y=0$) the integrands of $I_1(\\vec{r})$ and $I_2(\\vec{r})$ are $0$ and $I_0(\\vec{r})$ reduces to\n$$ I_0(z) = \\int_0^\\alpha \\sqrt{\\cos(\\theta_1)}\\sin(\\theta_1)(\\tau_s+\\tau_p \\cos(\\theta_2))\\exp(ik(\\Phi(NFP)+n_2z\\cos(\\theta_2)))d\\theta_1 $$\nWhere\n$$ \\Phi(NFP) = -NFP(n_1\\cos\\theta_1-n_2\\cos\\theta_2) $$\n$k$ is the wavenumber of the light rays in vacuo, i.e. $k = 2\\pi/\\lambda$. $\\alpha$ is the aperture semi-angle of the lens, i.e. $\\text{NA}=n_1 \\sin\\alpha$. Note that $n_1 = n_{obj}$ and $n_2 = n_{sample}$.\nWe can now implement these functions in Python.\nPython time %pylab inline\rimport scipy.integrate\rimport scipy.optimize\rimport seaborn as sns\rsns.set()\rdef complex_quadrature(func, a, b, **kwargs):\r\u0026#34;\u0026#34;\u0026#34;scipy.integrate.quad doesn\u0026#39;t deal with complex numbers, so this hack does\u0026#34;\u0026#34;\u0026#34;\rdef real_func(x):\rreturn real(func(x))\rdef imag_func(x):\rreturn imag(func(x))\rreal_integral = scipy.integrate.quad(real_func, a, b, **kwargs)\rimag_integral = scipy.integrate.quad(imag_func, a, b, **kwargs)\rreturn (real_integral[0] + 1j*imag_integral[0], real_integral[1:], imag_integral[1:])\r@vectorize\rdef i0(z, NFP, n1, n2, NA, wl):\r\u0026#34;\u0026#34;\u0026#34;This calculates e-field amplitude _relative to_ NFP, only along the z axis with x, y = 0, 0\u0026#34;\u0026#34;\u0026#34;\rtheta_max = arcsin(NA / n1)\rdef integrand(theta1):\rsin_t1 = sin(theta1)\rtheta2 = arcsin(n1 * sin_t1 / n2)\rsin_t2 = sin(theta2)\rcos_t1 = cos(theta1)\rcos_t2 = cos(theta2)\rts = 2 * sin_t2 * cos_t1 / sin(theta1 + theta2)\rtp = ts / cos(theta1 - theta2)\rk = 2 * pi / wl\rphi = -NFP * (n1 * cos_t1 - n2 * cos_t2)\r# make sure i is complex\r i = exp(1j * k * (phi + n2 * z * cos_t2))\ri *= sqrt(cos_t1) * sin_t1 * (ts + tp * cos_t2)\rreturn i\rreturn complex_quadrature(integrand, 0, theta_max)[0]\rA short test to see if the calculation works using the example from Egner and Hell a 1.518 oil objective 1.47 NA\nz = np.linspace(-2, 2, 128)\ra_exc = i0(z, -15, 1.518, 1.47, 1.33, 0.514)\ra_em = i0(z, -15, 1.518, 1.47, 1.33, 0.59)\rfig, ax = plt.subplots(dpi=150)\rax.plot(z, abs(a_exc)**2, label=\u0026#34;Excitation PSF\u0026#34;)\rax.plot(z, abs(a_em)**2, label=\u0026#34;Emission PSF\u0026#34;)\rax.plot(z, abs(a_exc)**2 * abs(a_em)**2, label=\u0026#34;Confocal PSF\u0026#34;)\rax.legend()\rax.yaxis.set_major_locator(plt.NullLocator())\rax.set_xlabel(\u0026#34;Axial Position (µm)\u0026#34;)\rax.set_title(\u0026#34;Computation Test, Oil Objective\u0026#34;)\r# we need an esimate of the focal shift in order to reduce computation time\r def otf_ratio(n1, n2, NA):\r\u0026#34;\u0026#34;\u0026#34;The OTF ratio as calculated from the geometrical proof\u0026#34;\u0026#34;\u0026#34;\rdef func(n):\r# fmax takes care of limiting NA\r return n - sqrt(np.fmax(0, n**2 - NA**2))\rreturn func(n1) / func(n2)\rdef _find_afp(NFP, n1, n2, NA, wl_ex, wl_em=None, *, res=32, width=5, ax=None):\r\u0026#34;\u0026#34;\u0026#34;Find the _apparent_ focal position based on the nominal focal position\u0026#34;\u0026#34;\u0026#34;\r# if no emission wavelength is given, then calculate the widefield PSF\r if wl_em is None:\rdef i0_min(z):\rreturn -abs(i0(z, NFP, n1, n2, NA, wl_ex))**2\r# otherwise calculate the confocal PSF\r else:\rdef i0_min(z):\rtoreturn = -abs(i0(z, NFP, n1, n2, NA, wl_ex))**2 return toreturn * abs(i0(z, NFP, n1, n2, NA, wl_em))**2\r# calculate the approximate focal shift, so the optimization is close to the optimum\r focal_shift = otf_ratio(n1, n2, NA)\r# make a rough low res estimate relative to the estimated focal shift\r low_res_z = np.linspace(-width, width, res) + NFP * (focal_shift - 1)\rlow_res_a = -i0_min(low_res_z)\rlow_res_max_idx = low_res_a.argmax()\r# optimize to find the proper location of the optimum\r high_res_max = scipy.optimize.minimize_scalar(i0_min, bounds=(low_res_z[low_res_max_idx - 1], low_res_z[low_res_max_idx + 1]), method=\u0026#39;bounded\u0026#39;, options=dict(xatol=1e-10))\r# looks like we failed to find a maximum\r if not high_res_max.success:\rraise RuntimeError(high_res_max.message)\r# make a plot\r if ax is not None:\rax.plot(low_res_z, low_res_a)\rax.axvline(high_res_max.x, c=\u0026#34;r\u0026#34;)\rmax_intensity = -high_res_max.fun\r# return the shifted AFP\r return high_res_max.x + NFP, max_intensity\rdef find_afp(NFP, *args, **kwargs):\r\u0026#34;\u0026#34;\u0026#34;A simple version to vectorize over z, for convenience\u0026#34;\u0026#34;\u0026#34;\rtry:\rreturn np.array([_find_afp(z, *args, **kwargs) for z in NFP])\rexcept TypeError:\rreturn _find_afp(NFP, *args, **kwargs)\rTesting On page 409 of Egner3 there are some example calculations that we can repeat to test the validity of the calculations.\nwith sns.color_palette(\u0026#34;inferno\u0026#34;):\r# our confocal calculations\r fig, ax = plt.subplots(dpi=150)\rnfps = (0, 5, 10, 15, 20, 25, 30, 50) glycerol_cf = find_afp(\rnfps,\r1.518, 1.473, 1.3, 0.514, 0.59,\rres=128, width=2, ax=ax\r)\r# values taken from table 20.1 of Egner and Hell\r glycerol_lit = np.array((\r(0, -0.28, -0.55, -0.83, -1.1, -1.33, -1.54, -2.30),\r(1, 0.95, 0.91, 0.78, 0.62, 0.5, 0.4, 0.31)\r)).T\r# percent differences between our calculations and theirs for focal shift\r print((glycerol_lit[:, 0] - (glycerol_cf[:, 0] - (0, 5, 10, 15, 20, 25, 30, 50))) / glycerol_lit[:, 0] * 100)\r# percent differences between our calculations and theirs for peak intensity\r print((glycerol_lit[:, 1] - glycerol_cf[:, 1] / glycerol_cf[:, 1].max()) / glycerol_lit[:, 1] * 100)\rax.yaxis.set_major_locator(plt.NullLocator())\rax.set_xlabel(\u0026#34;Deviation from Nominal Focal Position (µm)\u0026#34;)\rfor line in ax.get_lines():\rif len(line.get_data()[0]) == 2:\rline.remove()\rax.set_title(\u0026#34;Computation Test, Oil Objective in Glycerol\u0026#34;)\rax.legend(nfps, title=\u0026#34;NFP (µm)\u0026#34;)\r[ inf 2.2220463 0.62956575 1.5641702 1.51523215 -0.91086836\r-2.9878027 2.47268137]\r[ 0. -2.05250791 2.91190777 2.94368608 1.49427111 6.83299954\r14.99787706 39.09604286]\r with sns.color_palette(\u0026#34;inferno\u0026#34;):\r# our confocal calculations\r fig, ax = plt.subplots(dpi=150)\rnfps = (0, 5, 10, 15, 20, 25, 30, 50)\rwater_cf = find_afp(\rnfps,\r1.33, 1.473, 1.3, 0.514, 0.59,\rres=256, width=15, ax=ax\r)\r# values taken from table 20.1 of Egner and Hell\r water_lit = np.array((\r(0, -1.0, -1.83, -2.57, -3.3, -4.02, -4.72, -7.57),\r(1, 0.60, 0.39, 0.285, 0.23, 0.19, 0.166, 0.11)\r)).T\r# percent differences between our calculations and theirs for focal shift\r print((water_lit[:, 0] + (water_cf[:, 0] - (0, 5, 10, 15, 20, 25, 30, 50))) / water_lit[:, 0] * 100)\r# percent differences between our calculations and theirs for peak intensity\r print((water_lit[:, 1] - water_cf[:, 1] / water_cf[:, 1].max()) / water_lit[:, 1] * 100)\rax.yaxis.set_major_locator(plt.NullLocator())\rax.set_xlabel(\u0026#34;Deviation from Nominal Focal Position (µm)\u0026#34;)\rfor line in ax.get_lines():\rif len(line.get_data()[0]) == 2:\rline.remove()\rax.set_xlim(-5, 15)\rax.set_title(\u0026#34;Computation Test, Oil Objective in Water\u0026#34;)\rax.legend(nfps, title=\u0026#34;NFP (µm)\u0026#34;)\r[ inf -3.89876815 -1.16698752 0.24182932 1.60682485 2.02297875\r3.0281091 5.03027355]\r[ 0. 48.28097585 59.70939519 65.5089603 70.36385208 72.25077729\r75.80157613 81.9156686 ]\r Our simulations match the reported focal length shift to a few percent. However, there is larger error between the our intensity and theirs.\nSimulations for the Cryo-scope Here the objective is a 0.85 NA air objective and the sample medium is vitreous ice so $n_1=1$ and $n_2=1.3$.\nwith sns.color_palette(\u0026#34;inferno\u0026#34;):\rfig, ax = plt.subplots(dpi=300)\rnfps = (-8, -4, 0, 4, 8)\rfind_afp(nfps, 1.0, 1.3, 0.85, 0.52, res=128, ax=ax)\rax.yaxis.set_major_locator(plt.NullLocator())\rax.set_xlabel(\u0026#34;Deviation from Nominal Focal Position (µm)\u0026#34;)\rfor line in ax.get_lines():\rif len(line.get_data()[0]) == 2:\rline.remove()\rax.set_title(\u0026#34;Computation Test, Air Objective in Ice\u0026#34;)\rax.legend(nfps, title=\u0026#34;NFP (µm)\u0026#34;)\rClearly, spherical aberrations start to become problematic when you\u0026rsquo;re more than 10 µm from the best focal position (and this effect is worse the larger the mismatch between refractive indices).\nOne question we can ask is: how well does our geometric argument fare against the more complex vectorial calculation? We\u0026rsquo;ll calculate the actual focal position with the complex calculation for multiple nominal focal positions and compare the to the simpler calculation to see the size of the deviation.\n# make some NFPs in µm\r NFP = np.linspace(0,8)\r# calculate the AFPs\r AFP = find_afp(NFP, 1.0, 1.3, 0.85, 0.52)\r# geometrical stretch\r geom_m = otf_ratio(1.0, 1.3, 0.85)\rfig, ax = plt.subplots(dpi=150)\rax.plot(NFP, AFP[:, 0], \u0026#34;o\u0026#34;, label=\u0026#34;Vectorial\u0026#34;)\rax.plot(NFP, NFP * geom_m, label=\u0026#34;Geometrical\u0026#34;)\rax.set_ylabel(\u0026#34;Actual Focal Position (µm)\u0026#34;)\rax.set_xlabel(\u0026#34;Nominal Focal Position (µm)\u0026#34;)\rax.set_title(\u0026#34;Calculation Comparison\u0026#34;)\rax.legend()\r# geometrical stretch\r geom_m = otf_ratio(1.0, 1.3, 0.85)\rfig, (ax1, ax2) = plt.subplots(2, dpi=150, sharex=True)\rax1.plot(NFP, AFP[:, 0] - NFP * geom_m, \u0026#34;o\u0026#34;)\rax2.plot(NFP[1:], 100*((AFP[:, 0] - NFP * geom_m)/AFP[:, 0])[1:], \u0026#34;o\u0026#34;)\rax1.set_ylabel(\u0026#34;$\\Delta$ (µm)\u0026#34;)\rax2.set_ylabel(\u0026#34;$\\Delta$ (%)\u0026#34;)\rax2.set_xlabel(\u0026#34;Nominal Focal Position (µm)\u0026#34;)\rax1.set_title(\u0026#34;Difference between Vectorial and Geometrical Calculations\u0026#34;)\rslope_ratio = (AFP[1:, 0] / NFP[1:]).mean() / geom_m\rprint(f\u0026#34;The ratio between the complex slope and the simple slope is {slope_ratio:.0%}\u0026#34;)\rThe ratio between the complex slope and the simple slope is 99%\r At least as far as focal position is concerned the simple calculation is more than adequate over short distances.\nConclusions When talking about three dimensional imaging it seems that NA alone doesn\u0026rsquo;t tell the full story.7 As shown above, NA is the sole determinant of lateral resolution but the index of the sample comes into the equation for axial resolution. To put it another way, the lateral resolution of a 0.95 NA water objective is exactly the same (in theory) as the lateral resolution of 0.95 NA air objective but the axial resolution of the water objective is more than 70% worse! Moreover, index mismatch adds spherical aberration to the images. This can be alleviated to a certain extent with confocal imaging (c.f. Figure 1). Even so, it is to the microscopist\u0026rsquo;s advantage to use an objective with a design index as close as possible to the sample of interest (except in the case of TIRF microscopy).\nIf you want to download the Jupyter notebook I used to create this post you can do so here.\n  P. Török, P. Varga, Z. Laczik, G. R. Booker, Electromagnetic diffraction of light focused through a planar interface between materials of mismatched refractive indices: an integral representation. J. Opt. Soc. Am. A, JOSAA. 12, 325–332 (1995). \u0026#x21a9;\u0026#xfe0e;\n P. Török, S. J. Hewlett, P. Varga, The role of specimen-induced spherical aberration in confocal microscopy. Journal of Microscopy. 188, 158–172 (1997). \u0026#x21a9;\u0026#xfe0e;\n A. Egner, S. W. Hell, in Handbook Of Biological Confocal Microscopy (Springer, Boston, MA, 2006; https://link.springer.com/chapter/10.1007/978-0-387-45524-2_20), pp. 404–413. \u0026#x21a9;\u0026#xfe0e;\n It should be noted that Fresnel reflections at the interface increase with increasing angle such that the apodization function of the pupil rolls off much faster. Thus while the lateral support of the OTF is unchanged its actual shape will be different and will result in lower effective resolution at lower signal-to-noise ratios. \u0026#x21a9;\u0026#xfe0e;\n C. J. R. Sheppard, Depth of field in optical microscopy. Journal of Microscopy. 149, 73–75 (1988). \u0026#x21a9;\u0026#xfe0e;\n Squishing in frequency which is expansion in real space. \u0026#x21a9;\u0026#xfe0e;\n This is definitely true for two dimensional imaging as well: characterizing the frequency response of any system with a single number is always a bad idea. In practice, how the OTF approaches zero transmission is as import, if not more so, than where it hits zero. If your microscope transmits high spatial frequencies, but strongly attenuates them, you\u0026rsquo;ll need a high, and in some cases an unphysically high, signal to noise ratio to make use of them. \u0026#x21a9;\u0026#xfe0e;\n   ","date":1586563200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1587101076,"objectID":"f8452ec66faf5ba13d0c38b32c67186b","permalink":"https://david-hoffman.github.io/post/otf-squishing/","publishdate":"2020-04-11T00:00:00Z","relpermalink":"/post/otf-squishing/","section":"post","summary":"How to make your images look bad with high NA objectives","tags":["microscopy","optics","theory"],"title":"Oh no, I squished my OTF!","type":"post"},{"authors":["David P. Hoffman"],"categories":[],"content":"When designing an fluorescent microscope (or general optical system) one often wants to scan the beam position and/or angle at the sample (or object plane). It\u0026rsquo;s useful to remember that for any lens, especially for objective lenses, the back pupil plane is Fourier conjugate to the sample (object) plane of the lens.1 This has two important consequences for system design.\n A beam that is focused in the back pupil will be collimated at the object plane and vice versa. For instance, if you completely fill the back pupil of an objective with light (preferably overfilling it) then you will have a diffraction limited spot at the sample plane.2 If the beam enters the back pupil at an angle relative to the optical axis the position at the sample plane will be shifted relative to the optical axis.  Basically: angle in the back pupil is position at the object plane and position in the back pupil is angle at the object plane.\nScanning the beam position We can make a simple geometrical argument for this case (see figure above). The most important ray here is the chief ray (solid orange line) which passes through the center of the lens, the marginal rays (dashed orange lines) have been added for clarity. In this case we imagine a collimated beam of light entering the back aperture of an aplanatic lens at an angle $\\theta$ with respect to the optical axis. The collimated (parallel) rays converge at the focal plane a distance $f$ away from the lens forming a spot at a perpendicular distance $y$ from the optical axis. We can relate these quantities together with the following equation based solely on geometrical reasoning:\n$$ y = f \\tan \\theta $$\nFor simple lenses and large angles this equation doesn\u0026rsquo;t hold. But for specially designed optical systems, particularly scan lenses which are designed to specifically for this task, it can hold for very large angles and therefore fields of view.\nScanning the beam angle Here we take a slightly different approach. We know that if we were to launch a ray parallel to the optical axis from the very edge of the objective\u0026rsquo;s back pupil then the ray exiting the front of the objective would make an angle $\\theta$ with the optical axis such that $NA = n \\sin \\theta_{max}$ (the classic equation for numerical aperture). That means that if the ray were launched a distance $y$ from the optical axis that was less than half the pupil diameter we could define an effective NA as $NA_{eff} = y / f$ where $f$ is the focal length of the lens. We can derive this equation knowing that the pupil diameter is $D = 2 NA f$. This means we can solve for $\\theta$ as a function of $y$.\n$$ \\theta = \\sin^{-1} \\left(\\frac{y}{fn}\\right) $$\nWhy aren\u0026rsquo;t the two equations the same? I was surprised that these two equations would be different. The best explanation I can come up with is that for a well corrected, high magnification, system (such as a microscope objective) the entrance pupil (the pupil facing the object) is curved (in fact it lies on part of a spherical shell) while the exit pupil (the pupil facing infinity space) is flat. The entrance pupil has to be curved because a single point source (ignoring the fact that it\u0026rsquo;s an oscillating dipole) forms a spherical wave.\n  I\u0026rsquo;ll use sample plane and object plane interchangeably throughout. \u0026#x21a9;\u0026#xfe0e;\n Approximately $\\sigma\u0026rsquo; \\sigma = \\frac{\\lambda f}{\\pi}$ \u0026#x21a9;\u0026#xfe0e;\n   ","date":1583959591,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1587009732,"objectID":"c6a935aa17d3f55dfff2ef36335dbc35","permalink":"https://david-hoffman.github.io/post/angle-to-position-and-back/","publishdate":"2020-03-11T13:46:31-07:00","relpermalink":"/post/angle-to-position-and-back/","section":"post","summary":"The back pupil plane of a microscope objective is Fourier conjugate to it's image plane. We use this fact to perform laser scanning microscopy or create the interference patterns necessary for SIM or LLSM.","tags":["optics","microscopy"],"title":"Angle to Position and Back","type":"post"},{"authors":["David P. Hoffman"],"categories":[],"content":"In my professional life I\u0026rsquo;m always learning new things. Regrettably, I\u0026rsquo;m also constantly forgetting things. It seems as though my brain only has enough space for a given number of facts and figures, and that number is constantly changing. I figured, if I\u0026rsquo;ve had to learn something more than once, I may as well make a centralized and permanent note of it. Moreover, if I do it in a public forum (👋) someone else may benefit from my mistakes.\nThis list has been roughly divided into three sections: Optics, Lasers, and Code.\nOptics  Aperature stops are pupil conjugate Field stops are sample conjugate Pupil diameter $=2 NA f$, where the objective\u0026rsquo;s numerical aperture is NA and its effective focal length is $f$. The focal length can be calculated from the magnification and standard tube lens. For example, for a 60X Nikon objective where the tube lens has a nominal focal length of 200 mm the effective focal length of the objective is 200 mm/60 = 3.33 mm. Fourier transform property of lens: for a Gaussian beam propagating through a lens the beam sizes at each conjugate plane can be related to one another by the following equation: $$ \\sigma\u0026rsquo; \\sigma = \\frac{\\lambda f}{\\pi} $$ Where $\\sigma'$ and $\\sigma$ are the beam sizes at each conjugate plane and $\\lambda$ is the wavelength of the light and $f$ is the focal length of the lens. The relationship between angle and position at the sample and angle and position at the back pupil of a microscope objective. Herschel\u0026rsquo;s and Abbe\u0026rsquo;s Sine conditions  Herschel\u0026rsquo;s Condition invariance of axial magnification Abbe\u0026rsquo;s Sine Condition invariance of lateral magnification (and no coma or spherical aberration) Impossible to satisfy both conditions simultaneously, thus perfect volumetric imaging is impossible (this is different from collecting separate 2D planes like in normal microscopy).   If one approximates a diffraction limited PSF by a Gaussian profile the standard deviation of the profile is approximately equal to $0.45 \\lambda / 2 NA$ assuming that the f-number is approximately equal to $1/2 NA$ $f = \\left(1 - \\sqrt{1 - (\\text{NA} / n)^2}\\right) / 2$ where $f$ is the fraction of light collected by the objective as a function of numerical aperature (NA) and medium index ($n$). When NA is small this can be approximated as $(NA/n)^2/4$. Derived from this. Depth of field is $\\Delta z = \\lambda / \\left(n_{sample} - \\sqrt{n^2_{sample} - (\\text{NA} / n_{obj})^2}\\right)$  Lasers Code  (╯°□°)╯︵ ┻━┻  Useful links  https://www.newport.com/n/focusing-and-collimating http://www.loreti.it/chapterspdf/ch06_diffn_effcy.pdf  ","date":1583884800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1587009732,"objectID":"62b9af448e4cf580f3b9260b30b7c22c","permalink":"https://david-hoffman.github.io/post/things-ive-forgotten/","publishdate":"2020-03-11T00:00:00Z","relpermalink":"/post/things-ive-forgotten/","section":"post","summary":"My basic _modus operandi_ has been to learn and then, if not immediately, soon after forget them. This is a list I maintain of things once a remember them.","tags":["memories"],"title":"Things I've Forgotten","type":"post"},{"authors":["David P. Hoffman"],"categories":[],"content":"Energy Conversion Factors    1 kcal/mol     0.04336 eV   0.00159 h   349.75 cm$^{-1}$   6.948 × 10$^{-14}$ erg   4.184 kJ/mol       1 eV     23.06 kcal/mol   0.03675 h   8065.6 cm$^{-1}$   1.602 × 10$^{-12}$ erg       1 h     627.51 kcal/mol   27.212 eV   219,474.6 cm$^{-1}$   4.36 × 10$^{-11}$ erg   2 Ry       1 erg     1.439 × 10$^{13}$ kcal/mol   6.2415 × 10$^{11}$ eV   2.2937 × 10$^{10}$ h   5.034 × 10$^{15}$ cm$^{-1}$    Colors of Light Visible Light    Color nm eV $\\text{cm}^{-1}$     Red 700 1.77 14,300   Orange 620 2.00 16,100   Yellow 580 2.14 17,300   Green 530 2.34 18,900   Blue 470 2.64 21,300   Violet 420 2.95 23,800    All Light    Color nm eV $\\text{cm}^{-1}$     Radio $3\\times 10^{12}$ \u0026mdash; $3\\times 10^{8}$ $4\\times 10^{-10}$ \u0026mdash; $4\\times 10^{-6}$ $3\\times 10^{-6}$ \u0026mdash; $3\\times 10^{-2}$   Microwaves $3\\times 10^{8}$ \u0026mdash; $3\\times 10^{6}$ $4\\times 10^{-6}$ \u0026mdash; $4\\times 10^{-4}$ $3\\times 10^{-2}$ \u0026mdash; $3$   Far IR $3\\times 10^{6}$ \u0026mdash; $3\\times 10^{4}$ $4\\times 10^{-4}$ \u0026mdash; $4\\times 10^{-2}$ $3$ \u0026mdash; $300$   Near IR $3\\times 10^{4}$ \u0026mdash; $700$ $4\\times 10^{-2}$ \u0026mdash; $2$ $300$ \u0026mdash; $15,000$   Visible $700$ \u0026mdash; $420$ $2$ \u0026mdash; $3$ $15,000$ \u0026mdash; $24,000$   Near UV $420$ \u0026mdash; $300$ $3$ \u0026mdash; $4$ $24,000$ \u0026mdash; $30,000$   Vac UV $300$ \u0026mdash; $3$ $4$ \u0026mdash; $400$ $30,000$ \u0026mdash; 3\\e{6}   X-rays $3$ \u0026mdash; $0.003$ $400$ \u0026mdash; $4\\times 10^{5}$ $3\\times 10^{6}$ \u0026mdash; $3\\times 10^{9}$    Free Energies $$ \\Delta(G) = RT \\ln(K) $$ $$ \\Delta(G_1) - \\Delta(G_2) = RT\\ln\\left(\\frac{K_1}{K_2}\\right) $$ $$ \\Delta\\Delta(G) = 1\\text{ kcal/mol} \\Longleftrightarrow \\frac{K_1}{K_2} = 5.4 $$ $$ \\frac{K_1}{K_2} = 10^1 \\Longleftrightarrow \\Delta\\Delta G = 1.36 $$ $$ \\frac{K_1}{K_2} = 10^2 \\Longleftrightarrow \\Delta\\Delta G = 2.76 $$ $$ \\frac{K_1}{K_2} = 10^4 \\Longleftrightarrow \\Delta\\Delta G = 5.53 $$ $$ \\frac{K_1}{K_2} = 10^6 \\Longleftrightarrow \\Delta\\Delta G = 8.29 $$ $$ \\Delta G = 1.36 \\left( pK_{a1} - pK_{a2}\\right) $$\nAtomic Units    Length Bohr radius, $a_0$ 0.52918 Å     Force Constant 1 au $1.5569 \\times 10^6$ dyn/cm   Mass au, m$_\\text{e}$ $9.1095\\times 10^{-31}$ kg     $5.5\\times 10^{-4}$ amu    amu, m($^{12}$C)/12 $1.66\\times 10^{-27}$ kg     1822 au   Time au $2.4189\\times 10^{-17}$ s   Dipole Moment au 2.54 D     $8.478\\times 10^{-30}$ C-m    Miscellaneous Force Constants $$ 1\\text{ dyn/cm} = 1.44 \\times 10^{-3}\\frac{\\text{ kcal/mol}}{\\text{Å}^2} $$ $$ 1\\text{ Mdyn/cm} = 1440\\frac{\\text{ kcal/mol}}{\\text{Å}^2} $$\nThermal $$ k_BT (298\\text{ K}) = 9.4366 \\times 10^{-4}\\text{ h} $$ $$ RT (298\\text{ K}) = 2.4789\\text{ kJ/mol} = 0.5925\\text{ kcal/mol} $$ $$ e^2 = 14.3998\\text{ eV-Å} = 332.059\\text{ (kcal/mol)-Å} $$\nDownload a prettier PDF version of this post ","date":1583365285,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583383937,"objectID":"55fb7b3269f474fa47ec60194b634816","permalink":"https://david-hoffman.github.io/post/conversion-factors/","publishdate":"2020-03-04T15:41:25-08:00","relpermalink":"/post/conversion-factors/","section":"post","summary":"Some useful conversion factors from my graduate school days.","tags":["ultrafast","chemistry","science"],"title":"Conversion Factors","type":"post"},{"authors":["David P. Hoffman"],"categories":[],"content":"Let us define the dispersion of a function about zero as,\n$$ D_0(f)=\\int_{-\\infty}^\\infty x^2 |f(x)|^2 dx $$\nWhere $f(x)$ is some normalized square integrable function. In this case we\u0026rsquo;ll use a gaussian which is defined as,\n$$ f(x)\\propto e^{-x^2/2\\sigma^2} $$\nThis could be, for instance, the amplitude of the electric field of some laser pulse. We also know that the fourier transform of a gaussian is still a gaussian, i.e.\n$$ \\mathcal{F}[f(x)](k)=\\hat{f}(k)\\propto e^{-2\\pi^2\\sigma^2k^2} $$\nWe can relate the two dispersions to one another by multiplying them together, i.e.,\n$$ D_0(f)D_0(\\hat{f})=\\sigma^2_x\\sigma^2_k $$\nRemember that we know\n$$ \\sigma^2=\\int_{-\\infty}^{\\infty}x^2\\frac{e^{-x^2/2\\sigma^2}}{\\sqrt{2\\pi\\sigma^2}}dx $$\nUsing this fact we can say that\n$$ \\sigma^2_x=\\frac{\\sigma^2}{2} $$\nAnd\n$$ \\sigma^2_k=\\frac{1}{8\\pi^2\\sigma^2} $$\nWhich means that our dispersion relation is\n$$ D_0(f)D_0(\\hat{f})=\\frac{1}{16\\pi^2} $$\nWe can relate this to the FWHM of our pulse in either the $x$ or $k$ domain using the fact that $\\text{FWHM}=2 \\sqrt{2\\ln 2} \\sigma $,\n$$ \\Delta x \\Delta k=\\frac{2\\ln2}{\\pi}\\approx0.441 $$\nWhere $\\Delta x$ is the FWHM of the square of $f(x)$ in the $x$ domain. For instance, if $f(x)$ was the electric field of our pulse than $|f(x)|^2$ would be the intensity that we would measure of the pulse and $\\Delta x$ would be the measured FWHM of the intensity of the pulse.\nWe can make this more concrete by saying that we measured the frequency of the pulse in cm$^{-1}$ and the duration in fs,\n$$ \\Delta t (\\text{fs}) \\Delta \\nu (\\text{cm}^{-1})\\left(\\frac{ 2.99 \\times 10^{-5}\\text{ cm}}{\\text{fs}}\\right)=0.441 $$\nWe can rearrange this to be\n$$ \\Delta t (\\text{fs}) \\Delta \\nu (\\text{cm}^{-1})=1470\\text{ fs cm}^{-1} $$\nOr\n$$ \\Delta t (\\text{ps}) \\Delta \\nu (\\text{cm}^{-1})=15\\text{ ps cm}^{-1} $$\n","date":1583364245,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583383937,"objectID":"eab929df557eb668457dd3f64ba8e0f3","permalink":"https://david-hoffman.github.io/post/transform-limit/","publishdate":"2020-03-04T15:24:05-08:00","relpermalink":"/post/transform-limit/","section":"post","summary":"Here I derive the somewhat well known formula that for a transform limited pulse the bandwidth duration product is 15 ps cm$^{-1}$","tags":["ultrafast"],"title":"Derivation of the Transform Limit","type":"post"},{"authors":["David P. Hoffman"],"categories":[],"content":"This is my favorite movie from the paper.\n   It\u0026#39;s here!!!https://t.co/11j9LUa7xu\nOMG! OMG! 😱😱😱\n\u0026mdash; David Hoffman (@davephoffman) January 16, 2020  ","date":1579219200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"4d36b735ceb7d255f64c188997fe4676","permalink":"https://david-hoffman.github.io/publication/clem/","publishdate":"2020-03-01T22:01:31-08:00","relpermalink":"/publication/clem/","section":"publication","summary":"Cells need to compartmentalize thousands of distinct proteins, but the nanoscale spatial relationship of many proteins to overall intracellular ultrastructure remains poorly understood. Correlated light and electron microscopy approaches can help. Hoffman et al. combined cryogenic super-resolution fluorescence microscopy and focused ion beam–milling scanning electron microscopy to visualize protein-ultrastructure relationships in three dimensions across whole cells. The fusion of the two imaging modalities enabled identification and three-dimensional segmentation of morphologically complex structures within the crowded intracellular environment. The researchers observed unexpected relationships within a variety of cell types, including a web-like protein adhesion network between juxtaposed cerebellar granule neurons.","tags":["clem","microscopy","optics"],"title":"Freeze-frame of whole cells","type":"publication"},{"authors":["David P. Hoffman"],"categories":["microscopy"],"content":"","date":1578700800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"1efd257f6f450afb301b905a2515f2a4","permalink":"https://david-hoffman.github.io/publication/sim-tiling/","publishdate":"2020-03-04T21:00:04-08:00","relpermalink":"/publication/sim-tiling/","section":"publication","summary":"Structured illumination microscopy (SIM) is widely used for fast, long-term, live-cell super-resolution imaging. However, SIM images can contain substantial artifacts if the sample does not conform to the underlying assumptions of the reconstruction algorithm. Here we describe a simple, easy to implement, process that can be combined with any reconstruction algorithm to alleviate many common SIM reconstruction artifacts and briefly discuss possible extensions.","tags":["sim"],"title":"Tiled Reconstruction Improves Structured Illumination Microscopy","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1521590400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"39bef0a611719a642509d1320676322b","permalink":"https://david-hoffman.github.io/publication/difference-bands-tcne/","publishdate":"2020-03-05T10:00:14-08:00","relpermalink":"/publication/difference-bands-tcne/","section":"publication","summary":"The time-resolved femtosecond stimulated Raman spectra (FSRS) of a charge transfer (CT) excited noncovalent complex tetracyanoethylene:1-chloronaphthalene (TCNE:ClN) in dichloromethane (DCM) is reported with 40 fs time resolution. In the frequency domain, five FSRS peaks are observed with frequencies of 534, 858, 1069, 1392, and 1926 cm$^{–1}$. The most intense peaks at 534 and 1392 cm$^{–1}$ correspond to fundamentals while the features at 858, 1069, and 1926 cm$^{–1}$ are attributed to a difference frequency, an overtone and a combination frequency of the fundamentals, respectively. The frequency of the 1392 cm$^{–1}$ fundamental corresponding to the central C═C stretch of TCNE•– is red-shifted from the frequency of the steady state radical due to the close proximity and electron affinity of the countercation. The observation of a FSRS band at a difference frequency is analyzed. This analysis lends evidence for alternative nonlinear pathways of inverse Raman gain scattering (IRGS) or vertical-FSRS (VFSRS) which may contribute to the time-evolving FSRS spectrum on-resonance. Impulsive stimulated Raman measurements of the complex show coherent oscillations of the stimulated emission with frequencies of 153, 278, and 534 cm$^{–1}$. The 278 cm$^{–1}$ mode corresponds to Cl bending of the dichloromethane solvent. The center frequency of the 278 cm$^{–1}$ mode is modulated by a frequency of ∼30 cm$^{–1}$ which is attributed to the effect of librational motion of the dichloromethane solvent as it reorganizes around the nascent contact ion pair. The 153 ± 15 cm$^{–1}$ mode corresponds to an out-of-plane bending motion of TCNE. This motion modulates the intermolecular separation of the contact ion pair and thereby the overlap of the frontier orbitals which is crucial for rapid charge recombination in 5.9 ± 0.2 ps. High time-frequency resolution vibrational spectra provide unique molecular details regarding charge localization and recombination.","tags":["ultrafast"],"title":"Difference Bands TCNE","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1458604800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"e47a9ee4827e2df6e9d5ae60ac642456","permalink":"https://david-hoffman.github.io/publication/accounts-chemical-research/","publishdate":"2020-03-01T22:16:20-08:00","relpermalink":"/publication/accounts-chemical-research/","section":"publication","summary":"What role do vibrational coherences, if any, play in condensed phase photoreactivity? While we have observed vibrational coherences in almost any system where we look hard enough, it hasn't been clear if these are a cause or consequence of reactivity. In this survey of our own work we argue that for fast reactions (","tags":["ultrafast"],"title":"Good vibrations?","type":"publication"},{"authors":["David P. Hoffman"],"categories":[],"content":"","date":1434326400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"af2bc0bb033d35a4051636b5f927538f","permalink":"https://david-hoffman.github.io/publication/opv-film-fsrs/","publishdate":"2020-03-05T09:59:36-08:00","relpermalink":"/publication/opv-film-fsrs/","section":"publication","summary":"Exciton mobility is crucial to organic photovoltaic (OPV) efficiency, but accurate, quantitative measures and therefore precise understanding of this process are currently lacking. Here, we exploit the unique capabilities of femtosecond stimulated Raman spectroscopy (FSRS) to disentangle the signatures of the bulk and interfacial donor response in a bulk heterojunction composed of poly\u0026#91;2-methoxy-5-(3′,7′-dimethyloctyloxy)-1,4-phenylenevinylene](MDMO-PPV) and phenyl-C61-butyric acid methyl ester (PCBM). Surprisingly, we find that donor excitons are very mobile for the first ∼300 fs following excitation (before thermalization) even though their overall lifetime is significantly longer (170 ps). A sharp decrease in mobility occurs after the system relaxes out of the Franck–Condon (FC) region. From this observation we predict that any polymer lacking a significant resonance Raman effect and fluorescence Stokes shift, indicating slow FC relaxation and small reorganization energy, will make an efficient OPV material.","tags":[],"title":"Opv Film Fsrs","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1425513600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"bfb54913a0f223a40a7ce9f48fa3af11","permalink":"https://david-hoffman.github.io/publication/ring-opening/","publishdate":"2020-03-05T09:58:04-08:00","relpermalink":"/publication/ring-opening/","section":"publication","summary":"Two-dimensional femtosecond stimulated Raman spectroscopy (2D-FSRS) is used to probe the structural evolution of a modified cyclohexadiene as it undergoes a photoinduced ring opening reaction. Analysis of the excited state stimulated Raman vibrational data reveals oscillations of the center frequencies and amplitudes of 21 high frequency modes. These oscillations in vibrational properties are due to anharmonic couplings between the high frequency finger print modes and the impulsively driven low frequency molecular distortions in the excited state. The largest anharmonic couplings, with intrinsic oscillation magnitudes of up to 40 cm$^{–1}$, are observed between the 467 cm$^{–1}$ C–C bend and the 1333 cm$^{–1}$ C–C stretch with the 191 cm$^{–1}$ methyl wag, all of which are centered on the reactive cyclohexadiene moiety. Conversely, motions located on the periphery – the 993 cm$^{–1}$ phenyl bend, the 1389 cm$^{–1}$ methyl bend and 1580 cm$^{–1}$ phenyl C–C stretch – are coupled with the 104 cm$^{–1}$ asymmetric bend. These couplings reveal two key energetic pathways: one leading to formation of the ring-opened product and the other reversion back to the ground state. This work is also important because it presents a new powerful method for measuring anharmonicities of potential energy surfaces and determining their role in chemical reactivity.","tags":["ultrafast"],"title":"Ring Opening","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1402876800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"1cfe9215c3578453df62d8cd3a9d9c89","permalink":"https://david-hoffman.github.io/publication/conical-intersection/","publishdate":"2020-03-04T21:04:18-08:00","relpermalink":"/publication/conical-intersection/","section":"publication","summary":"We develop 2D-FSRS and use it to probe the conical intersection (CI) of a model photochemical reaction. In the end we were able to identify the two primary modes, the coupling and tuning modes, which comprise the CI and drive the reaction.","tags":["ultrafast"],"title":"Observing a reactive conical intersection","type":"publication"},{"authors":["David P. Hoffman"],"categories":[],"content":"","date":1400198400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"0f40cf545adf79432be77d9037b7794b","permalink":"https://david-hoffman.github.io/publication/thesis/","publishdate":"2020-03-05T09:57:53-08:00","relpermalink":"/publication/thesis/","section":"publication","summary":"Chemical reactions are defined by the change in the relative positions and bonding of nuclei in molecules. I have used femtosecond stimulated Raman spectroscopy (FSRS) to probe these transformations with structural specificity and high time precision revealing the mechanisms of two important classes of reactions; isomerization about an N=N bond and interfacial/intermolecular electron transfer. Isomerization about a double bond is one of the simplest, yet most important, photochemical reactions. In contrast to carbon double bonds, nitrogen double bonds can react via two possible mechanisms; rotation or inversion. To determine which pathway is predominant, I studied an azobenzene derivative using both FSRS and impulsive stimulated Raman spectroscopy (ISRS). The FSRS experiments demonstrated that the photochemical reaction occurs concomitantly with the 700 fs non-radiative decay of the excited state; because no major change in N=N stretching frequency was measured, I surmised that the reaction proceeds through an inversion pathway. My subsequent ISRS experiments confirmed this hypothesis; I observed a highly displaced, low frequency, inversion-like mode, indicating that initial movement out of the Franck-Condon region proceeds along an inversion coordinate. To probe which nuclear motions facilitate electron transfer and charge recombination, I used FSRS and the newly developed 2D-FSRS techniques to study two model systems, triphenylamine dyes bound to TiO2 nanoparticles and a molecular charge transfer (CT) dimer. In the dye-nanoparticle system I discovered that charge separation persists much longer ( 100 ps) than previously thought by using the juxtaposition of the FSRS and transient absorption data to separate the dynamics of the dye from that of the injected electron. Additionally, I discovered that dye constructs with an added vinyl group were susceptible to quenching via isomerization. The CT dimer offered an opportunity to study a system in which charge recombination occurred on a shorter timescale (~10 ps). Here I found that impulsively excited coherent nuclear motion in the excited state survived for more than 5 ps. These long lived coherences enabled the performance of 2D-FSRS to identify the coupling and tuning modes of the conical intersection that connects the charge transfer excited state with the neutral ground state and therefore the nuclear motions responsible for charge recombination. Furthermore, these data demonstrate that the photochemical reactivity is not mediated by phase-space randomization but rather by specific, coherent, nuclear trajectories. In this thesis I have demonstrated the power and utility of FSRS in probing condensed phase chemical reaction dynamics and provided a glimpse of the capabilities of 2D-FSRS. In general, 2D-FSRS provides a direct measure of the anharmonic coupling that controls reactivity. Looking forward, higher time resolution (broader band) 2D-FSRS will open up a whole new approach for characterizing transition states and energy transfer processes.","tags":[],"title":"PhD Thesis","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1382054400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"5531ba1f3ad4fab130ff7af64b10ad18","permalink":"https://david-hoffman.github.io/publication/ndab-isrs/","publishdate":"2020-03-05T09:58:40-08:00","relpermalink":"/publication/ndab-isrs/","section":"publication","summary":"Azobenzenes are versatile photoswitches that find application in optical memory, light-driven motors, and molecular gating. Despite many studies, the molecular details of their light induced trans to cis isomerization are still debated. To inform this discussion we probed the low frequency skeletal motions in an azobenzene derivative, 4-nitro-4′-dimethylamino-azobenzene (NDAB), with resonant impulsive stimulated Raman spectroscopy (RISRS). Four previously unobserved modes at 14, 47, 150, and 201 cm$^{–1}$ were found. Of these, the ∼50 cm$^{–1}$ inversion motion and the ∼15 cm$^{–1}$ torsional motion had particularly large intensities, suggesting that the excited state potential energy surface is steeply sloped along these coordinates in the Franck–Condon region. These data support a model in which NDAB isomerizes predominantly along a prompt inversion coordinate as well as a slower torsional motion that mitigates the phenyl–phenyl interactions on the pathway to the isomerized product.","tags":["ultrafast"],"title":"Ndab Isrs","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1378425600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"fba9f4ab881ae882301e25a85f0010e6","permalink":"https://david-hoffman.github.io/publication/etalon-fsrs/","publishdate":"2020-03-05T09:59:15-08:00","relpermalink":"/publication/etalon-fsrs/","section":"publication","summary":"A comparison between a Fabry-Pérot etalon filter and a conventional grating filter for producing the picosecond (ps) Raman pump pulses for femtosecond stimulated Raman spectroscopy (FSRS) is presented. It is shown that for pulses of equal energy the etalon filter produces Raman signals twice as large as that of the grating filter while suppressing the electronically resonant background signal. The time asymmetric profile of the etalon-generated pulse is shown to be responsible for both of these observations. A theoretical discussion is presented which quantitatively supports this hypothesis. It is concluded that etalons are the ideal method for the generation of narrowband ps pulses for FSRS because of the optical simplicity, efficiency, improved FSRS intensity and reduced backgrounds.","tags":["ultrafast"],"title":"Etalon Fsrs","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1363132800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"47608ea6d93a8e55b6e92c54bd0fb39f","permalink":"https://david-hoffman.github.io/publication/dye-sensitized-fsrs/","publishdate":"2020-03-05T09:59:01-08:00","relpermalink":"/publication/dye-sensitized-fsrs/","section":"publication","summary":"Interfacial electron transfer between sensitizers and semiconducting nanoparticles is a crucial yet poorly understood process. To address this problem, we have used transient absorption (TA) and femtosecond stimulated Raman spectroscopy (FSRS) to investigate the photoexcited dynamics of a series of triphenylamine–coumarin dye/TiO2 conjugates. The TA decay is multiexponential, spanning time scales from 100 fs to 100 ps, while the characteristic transient Raman spectrum of the radical cation decays biexponentially with a dominant ∼3 ps component. To explain these observations, we propose a model in which the decay of the TA is due to hot electrons migrating from surface trap states to the conduction band of TiO2 while the decay of the Raman signature is due to internal conversion of the dye molecule. Furthermore, the S1 Raman spectrum of TPAC3, a dye wherein a vinyl group separates the triphenylamine and coumarin moieties, is similar to the S1 Raman spectrum of trans-stilbene; we conclude that their S1 potential energy surfaces and reactivity are also similar. This correlation suggests that dyes containing vinyl linkers undergo photoisomerization that competes with electron injection.","tags":["ultrafast"],"title":"Dye Sensitized Fsrs","type":"publication"},{"authors":["David P. Hoffman"],"categories":["FSRS"],"content":"","date":1328054400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1583438065,"objectID":"a68064d83ca1af276473d12c5d978b0b","permalink":"https://david-hoffman.github.io/publication/ndab-fsrs/","publishdate":"2020-03-05T09:58:21-08:00","relpermalink":"/publication/ndab-fsrs/","section":"publication","summary":"Azobenzenes are used in many applications because of their robust and reversible light induced trans [leftrightharpoons] cis isomerization about the N[double bond, length as m-dash]N bond, but the mechanism of this ultrafast reaction has not been conclusively defined. Addressing this problem we have used Femtosecond Stimulated Raman Spectroscopy (FSRS) to determine the structural transients in the trans → cis photoisomerization of the azobenzene derivative, 4-nitro-4′-dimethylamino-azobenzene (NDAB). Key marker modes, such as the 1570/1590 cm$^{–1}$ NO2 stretch and the 1630 cm$^{–1}$ C–N(Me)2 stretch, enable the separation and analysis of distinct trans and cis photoproduct dynamics revealing the 400 fs Frank-Condon relaxation, the 800 fs timescale of the cis product formation and the 2 ps emergence and 8 ps relaxation of the unsuccessful ground state trans species. Based on these observations, we propose a reaction mechanism, including initial dilation of the CNN bend later joined by quick movement along the CCNN, CNNC and NNCC torsional coordinates that constitutes a mixed inversion-rotation mechanism.","tags":["ultrafast"],"title":"Ndab","type":"publication"}]